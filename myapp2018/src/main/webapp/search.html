<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TinyInsta</title>
</head>
<body>



	<script src="https://unpkg.com/mithril/mithril.js"></script>
	<script>	
	
	var Hello = {
		    view: function() {
		    	return m("main", [
		            m("h1", {class: "title"}, "Cherche Qqun"),
		            m("div", {id: "form"}, m(Form)),
		            m("h1", {class: "title"}, "Post"),
		            m("div", {id: "form"}, m(FormPost)),
		            m("h1", {class: "title"}, "Timeline"),
		            m("div", {id: "timeline"}, m(Timeline)),
		        ])
		    }
		}
			
	
	
	var Form = {
			view: function() {
		        return m("form", {
	                onsubmit: function(e) {
	                    e.preventDefault()
	                    m.request({
							method: "GET",
	            			url: "https://abstract-mode-260514.appspot.com/_ah/api/myApi/v1/getUser?username="+username,
						}).then(function(result) {
							console.log(result);
							m.mount(document.body, {
								view: function(){
									return m("div",[
										m("div",result.properties.username),
										m("button", {
					            			onclick: function() {
					                			console.log("je vais chercher");
					                			m.request({
													method: "POST",
	            									url: "https://abstract-mode-260514.appspot.com/_ah/api/myApi/v1/follow?follower="+sessionStorage.getItem("currentUser")+"&followed="+result.properties.username,
												}).then(function(result) {
													console.log("march√©");
												})
					            			}
					        			}, "Follow")
					    			])
								}
							})
						})
	                }
		        },
		        [
					m("label.label", "Username"),
					m("input.input[type=text][placeholder=Username]", {
						oninput: function (e) {username = e.target.value},
					}),
		            m("button.button[type=submit]", "Search"),
		        ])
		    }
	}
	
	
	var FormPost = {
			view: function() {
		        return m("form", {
	                onsubmit: function(e) {
	                    e.preventDefault()
	                    m.request({
							method: "POST",
	            			url: "https://abstract-mode-260514.appspot.com/_ah/api/myApi/v1/post?user="+sessionStorage.getItem("currentUser"),
	            			body: {
	            				"image":image,
	            				"text":text
	            			}
						}).then(function(result) {
							console.log(result);
						})
	                }
		        },
		        [
		        	m("label.label", "Image"),
					m("input.input[type=file][accept=image/*]", {
						onchange: function (e) {
							var file = e.target.files[0];
							var reader = new FileReader();
				            reader.readAsDataURL(file);
				            image = reader.result

				            reader.onloadend = function(e) {
				                console.log("oui "+ e.result);
				            }},

					}),
		        	m("label.label", "Text"),
					m("input.input[type=text][placeholder=Your caption here...]", {
						oninput: function (e) {text = e.target.value},
					}),
		            m("button.button[type=submit]", "Post"),
		        ])
		    }
	}
	
	/*
	var Timeline = {
			view: function() {
		    	return m("div",{
		    		fetch: function() {
		                m.request({
								method: "POST",
		            			url: "https://abstract-mode-260514.appspot.com/_ah/api/myApi/v1/timeline?user="+sessionStorage.getItem("currentUser"),
						}).then(function(result) {
							console.log(result);
						})
		    		}
		    	})
			}
	}*/
	
	
	var Data = {
		    todos: {
		        list: [],
		        fetch: function() {
	                m.request({
							method: "GET",
	            			url: "https://abstract-mode-260514.appspot.com/_ah/api/myApi/v1/timeline?user="+sessionStorage.getItem("currentUser"),
					}).then(function(result) {
						console.log(result);
					})
	    		}
		    }
		}

		var Timeline = {
		    oninit: Data.todos.fetch,
		    view: function() {
				return "boob";
				}
		    }

	
	/*

var ScoreView = {
		oninit: Score.loadList,
	    view: function() {
	        return m(".user-list", Score.list.map(function(item) {
	            return m(".user-list-item", item.properties.name + " " + item.properties.score)
	        }))
	    },
		
}






var Form = {
		view: function() {
	        return m("form", {
	                onsubmit: function(e) {
	                    e.preventDefault()
	                    Score.save()
	                }
	            }, [
	            m("label.label", "score"),
	            m("input.input[type=int][placeholder=score]",{
	                oninput: function (e) {Score.current.score=e.target.value},
	                value: Score.current.score
	            }),
	            m("label.label", "name"),
	            m("input.input[type=text][placeholder=name]", {
	                oninput: function (e) {Score.current.name=e.target.value},
	                value: Score.current.name
	            }),
	            m("button.button[type=submit]", "Save"),
	        ])
	    }
}
*/
m.mount(document.body, Hello)	


</script>
</body>
</html>